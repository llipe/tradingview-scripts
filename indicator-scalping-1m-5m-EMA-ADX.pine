// Versi칩n: v1.1.4
// Fecha: 2025-05-30
// Hora: 13:45 (GMT-4)
// Este indicador est치 dise침ado para generar se침ales de compra y venta en gr치ficos de 1 minuto 
// usando la pendiente de MACD en 5 minutos para determinar si entrar en short o long y usa
// Cruces de EMA, precios de cierre y ADX para determinar entrada.

//@version=6
indicator("Se침ales Scalping BTC M1/M5 - EMA + ADX", overlay=true)

// === PAR츼METROS DE CONFIGURACI칍N ===
emaFastLen     = input.int(9, title="EMA R치pida")
emaSlowLen     = input.int(21, title="EMA Lenta")
dmiLength      = input.int(14, title="DMI Periodo")
dmiSmoothing   = input.int(14, title="Suavizado ADX")
atrPeriod      = input.int(14, title="ATR Periodo")
adxThreshold   = input.float(20, title="Umbral m칤nimo ADX", step=0.1)
showFastEMA    = input.bool(false, title="Mostrar EMA R치pida")
showSlowEMA    = input.bool(false, title="Mostrar EMA Lenta")
macdFast       = input.int(12, title="MACD L칤nea R치pida")
macdSlow       = input.int(26, title="MACD L칤nea Lenta")
macdSignal     = input.int(9, title="MACD Se침al")
macdTimeframe  = input.timeframe("5", title="MACD Timeframe", options=["1", "3", "5", "15", "30", "45", "60", "120", "180", "240", "D", "W"])

// === C츼LCULO DE INDICADORES ===
emaFast        = ta.ema(close, emaFastLen)
emaSlow        = ta.ema(close, emaSlowLen)
atr            = ta.atr(atrPeriod)
[plusDI, minusDI, adx] = ta.dmi(dmiLength, dmiSmoothing)

// C치lculo del MACD en timeframe configurable
[macdLine, signalLine, _] = request.security(syminfo.tickerid, macdTimeframe, ta.macd(close, macdFast, macdSlow, macdSignal))
macdSlope = request.security(syminfo.tickerid, macdTimeframe, macdLine - macdLine[1])

// === CONDICIONES DE SE칌AL ===
rawBuySignal  = emaFast > emaSlow and close > high[1] and close > emaFast and adx > adxThreshold and macdSlope > 0  // Pendiente positiva para compras
rawSellSignal = (emaFast < emaSlow or close < emaFast or adx < adxThreshold) and close < low[1] and macdSlope < 0  // Pendiente negativa para ventas

// === ESTADO PERSISTENTE SEPARADO ===
var bool inBuyPosition = false
var bool inSellPosition = false

// === FLAGS TEMPORALES SEPARADOS ===
buyEntry = rawBuySignal and not inBuyPosition and not inSellPosition
buyExit = (emaFast < emaSlow or close < emaFast) and inBuyPosition

sellEntry = rawSellSignal and not inSellPosition and not inBuyPosition
sellExit = (emaFast > emaSlow or close > emaFast) and inSellPosition

// === GESTI칍N DE SE칌ALES SEPARADAS ===
if buyEntry
    label.new(bar_index, low - atr * 1, "Buy\nMACD Slope:\n" + str.tostring(macdSlope, "#.####"), style=label.style_label_up, color=color.green, textcolor=color.white, size=size.small)
    inBuyPosition := true
    inSellPosition := false

if buyExit
    label.new(bar_index, high + atr * 1, "Exit\n Buy", style=label.style_label_down, color=color.yellow, textcolor=color.black, size=size.small)
    inBuyPosition := false

if sellEntry
    label.new(bar_index, high + atr * 1, "Sell\nMACD Slope:\n" + str.tostring(macdSlope, "#.####"), style=label.style_label_down, color=color.red, textcolor=color.white, size=size.small)
    inSellPosition := true
    inBuyPosition := false

if sellExit
    label.new(bar_index, low - atr * 1, "Exit\n Sell", style=label.style_label_up, color=color.yellow, textcolor=color.black, size=size.small)
    inSellPosition := false

// === ALERTAS SEPARADAS ===
alertcondition(buyEntry, title="Entrada Compra", message="游늳 Se침al de Entrada Compra")
alertcondition(buyExit, title="Salida Compra", message="游댃 Se침al de Salida Compra")
alertcondition(sellEntry, title="Entrada Venta", message="游늴 Se침al de Entrada Venta")
alertcondition(sellExit, title="Salida Venta", message="游댃 Se침al de Salida Venta")

// === VISUALIZACI칍N OPCIONAL DE EMAs ===
plot(showFastEMA ? emaFast : na, color=color.orange, title="EMA R치pida")
plot(showSlowEMA ? emaSlow : na, color=color.blue, title="EMA Lenta")
